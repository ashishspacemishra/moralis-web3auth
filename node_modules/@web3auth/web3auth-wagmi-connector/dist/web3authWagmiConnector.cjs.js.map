{"version":3,"file":"web3authWagmiConnector.cjs.js","mappings":"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","sources":["webpack://@web3auth/web3auth-wagmi-connector/external commonjs2 \"@babel/runtime/helpers/defineProperty\"","webpack://@web3auth/web3auth-wagmi-connector/external commonjs2 \"@wagmi/core\"","webpack://@web3auth/web3auth-wagmi-connector/external commonjs \"@web3auth/base\"","webpack://@web3auth/web3auth-wagmi-connector/external commonjs \"ethers\"","webpack://@web3auth/web3auth-wagmi-connector/external commonjs \"ethers/lib/utils\"","webpack://@web3auth/web3auth-wagmi-connector/external commonjs2 \"loglevel\"","webpack://@web3auth/web3auth-wagmi-connector/./src/lib/connector.ts","webpack://@web3auth/web3auth-wagmi-connector/webpack/bootstrap","webpack://@web3auth/web3auth-wagmi-connector/webpack/runtime/compat get default export","webpack://@web3auth/web3auth-wagmi-connector/webpack/runtime/define property getters","webpack://@web3auth/web3auth-wagmi-connector/webpack/runtime/hasOwnProperty shorthand","webpack://@web3auth/web3auth-wagmi-connector/webpack/runtime/make namespace object","webpack://@web3auth/web3auth-wagmi-connector/./src/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/defineProperty\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@wagmi/core\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@web3auth/base\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"ethers\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"ethers/lib/utils\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"loglevel\");","import { Address, Chain, Connector, ConnectorData, normalizeChainId, UserRejectedRequestError } from \"@wagmi/core\";\nimport { ADAPTER_STATUS, IWeb3Auth, SafeEventEmitterProvider, WALLET_ADAPTER_TYPE, WALLET_ADAPTERS } from \"@web3auth/base\";\nimport type { IWeb3AuthModal, ModalConfig } from \"@web3auth/modal\";\nimport type { OpenloginLoginParams } from \"@web3auth/openlogin-adapter\";\nimport { providers, Signer } from \"ethers\";\nimport { getAddress } from \"ethers/lib/utils\";\nimport log from \"loglevel\";\n\nimport type { Options } from \"./interfaces\";\n\nconst IS_SERVER = typeof window === \"undefined\";\n\nexport class Web3AuthConnector extends Connector {\n  ready = !IS_SERVER;\n\n  readonly id = \"web3auth\";\n\n  readonly name = \"Web3Auth\";\n\n  provider: SafeEventEmitterProvider | null = null;\n\n  web3AuthInstance: IWeb3Auth | IWeb3AuthModal;\n\n  initialChainId: number;\n\n  loginParams: OpenloginLoginParams | null;\n\n  modalConfig: Record<WALLET_ADAPTER_TYPE, ModalConfig> | null;\n\n  constructor(config: { chains?: Chain[]; options: Options }) {\n    super(config);\n    this.web3AuthInstance = config.options.web3AuthInstance;\n    this.loginParams = config.options.loginParams || null;\n    this.modalConfig = config.options.modalConfig || null;\n    this.initialChainId = config.chains[0].id;\n  }\n\n  async connect(): Promise<Required<ConnectorData>> {\n    function isIWeb3AuthModal(obj: IWeb3Auth | IWeb3AuthModal): obj is IWeb3AuthModal {\n      return typeof (obj as IWeb3AuthModal).initModal !== \"undefined\";\n    }\n\n    try {\n      this.emit(\"message\", {\n        type: \"connecting\",\n      });\n\n      if (this.web3AuthInstance.status === ADAPTER_STATUS.NOT_READY) {\n        if (isIWeb3AuthModal(this.web3AuthInstance)) {\n          await this.web3AuthInstance.initModal({\n            modalConfig: this.modalConfig,\n          });\n        } else if (this.loginParams) {\n          await this.web3AuthInstance.init();\n        } else {\n          log.error(\"please provide a valid loginParams when not using @web3auth/modal\");\n          throw new UserRejectedRequestError(\"please provide a valid loginParams when not using @web3auth/modal\");\n        }\n      }\n\n      let { provider } = this.web3AuthInstance;\n\n      if (!provider) {\n        if (isIWeb3AuthModal(this.web3AuthInstance)) {\n          provider = await this.web3AuthInstance.connect();\n        } else if (this.loginParams) {\n          provider = await this.web3AuthInstance.connectTo(WALLET_ADAPTERS.OPENLOGIN, this.loginParams);\n        } else {\n          log.error(\"please provide a valid loginParams when not using @web3auth/modal\");\n          throw new UserRejectedRequestError(\"please provide a valid loginParams when not using @web3auth/modal\");\n        }\n      }\n\n      const signer = await this.getSigner();\n      const account = (await signer.getAddress()) as Address;\n      provider.on(\"accountsChanged\", this.onAccountsChanged.bind(this));\n      provider.on(\"chainChanged\", this.onChainChanged.bind(this));\n      const chainId = await this.getChainId();\n      const unsupported = this.isChainUnsupported(chainId);\n      return {\n        account,\n        chain: {\n          id: chainId,\n          unsupported,\n        },\n        provider,\n      };\n    } catch (error) {\n      log.error(\"error while connecting\", error);\n      throw new UserRejectedRequestError(\"Something went wrong\");\n    }\n  }\n\n  async getAccount(): Promise<Address> {\n    const provider = new providers.Web3Provider(await this.getProvider());\n    const signer = provider.getSigner();\n    const account = await signer.getAddress();\n    return account as Address;\n  }\n\n  async getProvider() {\n    if (this.provider) {\n      return this.provider;\n    }\n    this.provider = this.web3AuthInstance.provider;\n    return this.provider;\n  }\n\n  async getSigner(): Promise<Signer> {\n    const provider = new providers.Web3Provider(await this.getProvider());\n    const signer = provider.getSigner();\n    return signer;\n  }\n\n  async isAuthorized() {\n    try {\n      const account = await this.getAccount();\n      return !!(account && this.provider);\n    } catch {\n      return false;\n    }\n  }\n\n  async getChainId(): Promise<number> {\n    try {\n      if (this.provider) {\n        const chainId = await this.provider.request({ method: \"eth_chainId\" });\n        if (chainId) {\n          return normalizeChainId(chainId as string);\n        }\n      }\n      if (this.initialChainId) {\n        return this.initialChainId;\n      }\n      throw new Error(\"Chain ID is not defined\");\n    } catch (error) {\n      log.error(\"error\", error);\n      throw error;\n    }\n  }\n\n  async switchChain(chainId: number) {\n    try {\n      const chain = this.chains.find((x) => x.id === chainId);\n      if (!chain) throw new Error(`Unsupported chainId: ${chainId}`);\n      const provider = await this.getProvider();\n      if (!provider) throw new Error(\"Please login first\");\n      await this.provider.request({\n        method: \"wallet_addEthereumChain\",\n        params: [\n          {\n            chainId: `0x${chain.id.toString(16)}`,\n            chainName: chain.name,\n            rpcUrls: [chain.rpcUrls.default.http],\n            blockExplorerUrls: [chain.blockExplorers?.default?.url],\n            nativeCurrency: {\n              symbol: chain.nativeCurrency?.symbol || \"ETH\",\n            },\n          },\n        ],\n      });\n      await this.provider.request({\n        method: \"wallet_switchEthereumChain\",\n        params: [\n          {\n            chainId: `0x${chain.id.toString(16)}`,\n          },\n        ],\n      });\n      return chain;\n    } catch (error) {\n      log.error(\"Error: Cannot change chain\", error);\n      throw error;\n    }\n  }\n\n  async disconnect(): Promise<void> {\n    await this.web3AuthInstance.logout();\n    this.provider = null;\n  }\n\n  protected onAccountsChanged(accounts: string[]): void {\n    if (accounts.length === 0) this.emit(\"disconnect\");\n    else this.emit(\"change\", { account: getAddress(accounts[0]) });\n  }\n\n  protected isChainUnsupported(chainId: number): boolean {\n    return !this.chains.some((x) => x.id === chainId);\n  }\n\n  protected onChainChanged(chainId: string | number): void {\n    const id = normalizeChainId(chainId);\n    const unsupported = this.isChainUnsupported(id);\n    this.emit(\"change\", { chain: { id, unsupported } });\n  }\n\n  protected onDisconnect(): void {\n    this.emit(\"disconnect\");\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export * from \"./lib/connector\";\nexport * from \"./lib/interfaces\";\n"],"names":["Connector","normalizeChainId","UserRejectedRequestError","ADAPTER_STATUS","WALLET_ADAPTERS","providers","getAddress","log","IS_SERVER","window","Web3AuthConnector","constructor","config","web3AuthInstance","options","loginParams","modalConfig","initialChainId","chains","id","connect","isIWeb3AuthModal","obj","initModal","emit","type","status","NOT_READY","init","error","provider","connectTo","OPENLOGIN","signer","getSigner","account","on","onAccountsChanged","bind","onChainChanged","chainId","getChainId","unsupported","isChainUnsupported","chain","getAccount","Web3Provider","getProvider","isAuthorized","request","method","Error","switchChain","find","x","params","toString","chainName","name","rpcUrls","default","http","blockExplorerUrls","blockExplorers","url","nativeCurrency","symbol","disconnect","logout","accounts","length","some","onDisconnect"],"sourceRoot":""}